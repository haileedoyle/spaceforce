!function(e,t){"function"==typeof define&&define.amd?define([],t):e.Sync2AdSDK=t()}(this,function(){var requirejs,require,define;return function(e){function t(e,t){return v.call(e,t)}function n(e,t){var n,i,a,s,r,o,d,p,c,l,u,g,f=t&&t.split("/"),h=_.map,S=h&&h["*"]||{};if(e){for(e=e.split("/"),r=e.length-1,_.nodeIdCompat&&E.test(e[r])&&(e[r]=e[r].replace(E,"")),"."===e[0].charAt(0)&&f&&(g=f.slice(0,f.length-1),e=g.concat(e)),c=0;c<e.length;c++)if(u=e[c],"."===u)e.splice(c,1),c-=1;else if(".."===u){if(0===c||1===c&&".."===e[2]||".."===e[c-1])continue;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}if((f||S)&&h){for(n=e.split("/"),c=n.length;c>0;c-=1){if(i=n.slice(0,c).join("/"),f)for(l=f.length;l>0;l-=1)if(a=h[f.slice(0,l).join("/")],a&&(a=a[i])){s=a,o=c;break}if(s)break;!d&&S&&S[i]&&(d=S[i],p=c)}!s&&d&&(s=d,o=p),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function i(t,n){return function(){var i=m.call(arguments,0);return"string"!=typeof i[0]&&1===i.length&&i.push(null),l.apply(e,i.concat([t,n]))}}function a(e){return function(t){return n(t,e)}}function s(e){return function(t){f[e]=t}}function r(n){if(t(h,n)){var i=h[n];delete h[n],S[n]=!0,c.apply(e,i)}if(!t(f,n)&&!t(S,n))throw new Error("No "+n);return f[n]}function o(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function d(e){return e?o(e):[]}function p(e){return function(){return _&&_.config&&_.config[e]||{}}}var c,l,u,g,f={},h={},_={},S={},v=Object.prototype.hasOwnProperty,m=[].slice,E=/\.js$/;u=function(e,t){var i,s=o(e),d=s[0],p=t[1];return e=s[1],d&&(d=n(d,p),i=r(d)),d?e=i&&i.normalize?i.normalize(e,a(p)):n(e,p):(e=n(e,p),s=o(e),d=s[0],e=s[1],d&&(i=r(d))),{f:d?d+"!"+e:e,n:e,pr:d,p:i}},g={require:function(e){return i(e)},exports:function(e){var t=f[e];return"undefined"!=typeof t?t:f[e]={}},module:function(e){return{id:e,uri:"",exports:f[e],config:p(e)}}},c=function(n,a,o,p){var c,l,_,v,m,E,A,I=[],y=typeof o;if(p=p||n,E=d(p),"undefined"===y||"function"===y){for(a=!a.length&&o.length?["require","exports","module"]:a,m=0;m<a.length;m+=1)if(v=u(a[m],E),l=v.f,"require"===l)I[m]=g.require(n);else if("exports"===l)I[m]=g.exports(n),A=!0;else if("module"===l)c=I[m]=g.module(n);else if(t(f,l)||t(h,l)||t(S,l))I[m]=r(l);else{if(!v.p)throw new Error(n+" missing "+l);v.p.load(v.n,i(p,!0),s(l),{}),I[m]=f[l]}_=o?o.apply(f[n],I):void 0,n&&(c&&c.exports!==e&&c.exports!==f[n]?f[n]=c.exports:_===e&&A||(f[n]=_))}else n&&(f[n]=o)},requirejs=require=l=function(t,n,i,a,s){if("string"==typeof t)return g[t]?g[t](n):r(u(t,d(n)).f);if(!t.splice){if(_=t,_.deps&&l(_.deps,_.callback),!n)return;n.splice?(t=n,n=i,i=null):t=e}return n=n||function(){},"function"==typeof i&&(i=a,a=s),a?c(e,t,n,i):setTimeout(function(){c(e,t,n,i)},4),l},l.config=function(e){return l(e)},requirejs._defined=f,define=function(e,n,i){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");n.splice||(i=n,n=[]),t(f,e)||t(h,e)||(h[e]=[e,n,i])},define.amd={jQuery:!0}}(),define("vendor/almond/almond",function(){}),define("js/Models/Sync2AdEvent",["./AdsCampaign"],function(e){function t(t){this.eventId=t.eventId||0,this.date=t.date||new Date(0),this.type=t.type||0,this.campaign=t.campaign||new e}return t.EventType={AD_PUSHED:2,AD_TEASER_OPENED:3,AD_EXTEND_OPENED:4,AD_CLOSED:5},t}),define("js/Listeners/Sync2AdDefaultListener",["../Models/Sync2AdEvent"],function(e){return{shouldStartAds:function(e){return!0},onEvent:function(t){var n=require("js/Utils/AdsUtils");switch(t.type){case t.type==e.EventType.AD_PUSHED:case t.type==e.EventType.AD_TEASER_OPENED:case t.type==e.EventType.AD_EXTEND_OPENED:case t.type==e.EventType.AD_CLOSED:default:n.adsLog.Debug(t)}},onLog:function(e){},onPassback:function(){}}}),define("js/Utils/AdsUtils",["../Listeners/Sync2AdDefaultListener"],function(Sync2AdDefaultListener){function AdsUtils(){}var _instance=null,logLevel={DEBUG:0,INFO:1,WARNING:2,ERROR:3};return AdsUtils._mForceLog=!1,AdsUtils._mLogEnabled=!1,AdsUtils._mLogLevel=logLevel.DEBUG,AdsUtils.prototype.LogLevel=logLevel,AdsUtils._sync2AdListener=Sync2AdDefaultListener,AdsUtils.prototype.adsLog={Error:function(e){(AdsUtils._mLogEnabled&&AdsUtils._mLogLevel<=logLevel.ERROR||AdsUtils._mForceLog)&&(console.error(AdsUtils.prototype.stripHtml(e)),AdsUtils._sync2AdListener.onLog(e))},Warning:function(e){(AdsUtils._mLogEnabled&&AdsUtils._mLogLevel<=logLevel.WARNING||AdsUtils._mForceLog)&&(console.warn(AdsUtils.prototype.stripHtml(e)),AdsUtils._sync2AdListener.onLog(e))},Info:function(e){(AdsUtils._mLogEnabled&&AdsUtils._mLogLevel<=logLevel.INFO||AdsUtils._mForceLog)&&(console.info(AdsUtils.prototype.stripHtml(e)),AdsUtils._sync2AdListener.onLog(e))},Debug:function(e){(AdsUtils._mLogEnabled&&AdsUtils._mLogLevel<=logLevel.DEBUG||AdsUtils._mForceLog)&&(console.debug(AdsUtils.prototype.stripHtml(e)),AdsUtils._sync2AdListener.onLog(e))}},AdsUtils.prototype.logLevelToString=function(){return AdsUtils._mLogLevel==logLevel.DEBUG?"debug":AdsUtils._mLogLevel==logLevel.INFO?"info":AdsUtils._mLogLevel==logLevel.WARNING?"warning":AdsUtils._mLogLevel==logLevel.ERROR?"error":"none"},AdsUtils.prototype.stripHtml=function(e){var t=document.createElement("DIV");return t.innerHTML=e,t.textContent||t.innerText||""},AdsUtils.prototype.isMobile=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("mobile")>-1&&e.indexOf("ipad")==-1||e.indexOf("iphone")>-1||e.indexOf("ipod")>-1},AdsUtils.prototype.isTablet=function(){var e=navigator.userAgent.toLowerCase();return!this.isMobile()&&!this.isDesktop()||e.indexOf("ipad")>-1},AdsUtils.prototype.isDesktop=function(){var e=navigator.platform.toLowerCase();return e.indexOf("win")>-1||e.indexOf("mac")>-1&&!this.isIOS()||e.indexOf("linux")>-1&&e.indexOf("arm")==-1},AdsUtils.prototype.isIOS=function(){return!!/iPhone|iPad|iPod/i.test(navigator.userAgent)},AdsUtils.prototype.isAndroid=function(){return navigator.userAgent.toLowerCase().indexOf("android")>-1},AdsUtils.prototype.isWindowsPhone=function(){return/IEMobile|Windows Phone|WPDesktop|Edge/i.test(navigator.userAgent)},AdsUtils.prototype.isMSIE=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");return!!(t>0||navigator.userAgent.match(/Trident.*rv\:11\./))},AdsUtils.prototype.setSync2AdListener=function(e){AdsUtils._sync2AdListener=e},AdsUtils.prototype.setLogEnabled=function(e,t){AdsUtils._mLogEnabled=e,t&&(AdsUtils._mLogLevel=t)},AdsUtils.prototype.forceLog=function(){AdsUtils._mForceLog=!0},AdsUtils.prototype.getSettingsJson=function(e,t,n){e="/"==e[e.length-1]?e.substring(0,e.length-1):e,e=/services/i.test(e)?e+"/jsons/"+t+"-Settings.json":e+"/"+t+"-Settings.json",this.getRequest(e,function(e,t){n&&n(JSON.parse(e))})},AdsUtils.prototype.getCampaignJson=function(e,t,n,i){e="/"==e[e.length-1]?e.substring(0,e.length-1):e,e=/services/i.test(e)?e+"/jsons/"+t+"-Campaigns.json":e+"/"+t+"-Campaigns.json",this.getRequest(e+"?did="+n,function(e,t){i&&i(JSON.parse(e))})},AdsUtils.prototype.getRequest=function(e,t){var n=new(XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");n.open("GET",e,1),n.onreadystatechange=function(){n.readyState>3&&t&&t(n.responseText)},n.send()},AdsUtils.prototype.mapJson=function(json,mapping,context){mapping.forEach(function(element){var elm=eval("this."+element["long"]),jsonElm=eval("json."+element["short"]);void 0!=jsonElm&&("string"==typeof elm?eval("this."+element["long"]+'="'+jsonElm+'"'):"object"==typeof elm&&elm instanceof Date?eval("this."+element["long"]+'.setTime(Date.parse("'+jsonElm+'"))'):eval("this."+element["long"]+"="+jsonElm)),elm=void 0,jsonElm=void 0},context)},AdsUtils.getInstance=function(){return null===_instance&&(_instance=new AdsUtils),_instance},AdsUtils.getInstance()}),define("js/Models/AdsPackage",["../Utils/AdsUtils"],function(e){function t(){this.device="",this.url="",this.unzippedUrl="",this.position={popup:{x:"",y:"",w:"",h:""},content:{x:"",y:"",w:"",h:""}}}return t.mapping=[{"long":"device","short":"d"},{"long":"url","short":"u"},{"long":"unzippedUrl","short":"uu"},{"long":"position.popup.x","short":"pst.p.x"},{"long":"position.popup.y","short":"pst.p.y"},{"long":"position.popup.w","short":"pst.p.w"},{"long":"position.popup.h","short":"pst.p.h"},{"long":"position.content.x","short":"pst.c.x"},{"long":"position.content.y","short":"pst.c.y"},{"long":"position.content.w","short":"pst.c.w"},{"long":"position.content.h","short":"pst.c.h"}],t.prototype.initWithJson=function(n){e.mapJson(n,t.mapping,this)},t}),define("js/Models/AdsCampaign",["./AdsPackage","../Utils/AdsUtils"],function(e,t){function n(){this.adLastUpdated=new Date(0),this.id="",this.name="",this.contentUrl="",this.contentLastUpdated="",this.isSurfaced=!1,this.pushType="",this.isCapped=!1,this.campaignCappingSurfaceMax=0,this.campaignCappingIntervalSeconds=0,this.campaignCappingMaxSurfacePerInterval=0,this.campaignCappingMinDeltaIntervalForSurface=0,this.pushActivationTrack="",this.packages=[],this.currentPackage=null}return n.mapping=[{"long":"adLastUpdated","short":"alu"},{"long":"id","short":"i"},{"long":"name","short":"n"},{"long":"contentUrl","short":"cu"},{"long":"contentLastUpdated","short":"clu"},{"long":"isSurfaced","short":"is"},{"long":"pushType","short":"pt"},{"long":"isCapped","short":"ic"},{"long":"campaignCappingSurfaceMax","short":"ccsm"},{"long":"campaignCappingIntervalSeconds","short":"ccis"},{"long":"campaignCappingMaxSurfacePerInterval","short":"ccmspi"},{"long":"campaignCappingMinDeltaIntervalForSurface","short":"ccmdifs"},{"long":"pushActivationTrack","short":"pat"}],n.prototype.init=function(){},n.prototype.initWithJson=function(e){return t.mapJson(e,n.mapping,this)},n.prototype.getContent=function(e){t.getRequest(this.contentUrl.replace("http://","https://")+"?clu="+this.contentLastUpdated.replace(/-/g,"").replace(/:/g,""),n._onGetContent.bind(this,e))},n._onGetContent=function(t,n){var i=JSON.parse(n);i&&i.pkg.length>0&&(this.packages=[],i.pkg.forEach(function(t){var n=new e;n.initWithJson(t),this.packages.push(n),n=void 0},this)),t(),i=void 0},n.prototype.isCapped=function(){return!1},n.prototype.isObjectiveReached=function(){return!1},n}),define("js/Managers/AdsCampaignManager",["../Models/AdsCampaign","../Utils/AdsUtils"],function(e,t){function n(){}var i=null;return n._endpoint,n._siteId,n._activeCampaigns=[],n._activeCampaignsCount=0,n._managerListener,n.prototype.init=function(e){},n.prototype.setManagerListener=function(e){n._managerListener=e},n.prototype.reset=function(){n._activeCampaigns=[]},n.prototype.getActiveCampaigns=function(){return n._activeCampaigns},n.prototype.fetchCampaignFromJSON=function(e){t.getCampaignJson(n._endpoint,n._siteId,e,n._onCampaignFetched.bind(n))},n._onCampaignFetched=function(t){t&&t.al&&(n._activeCampaigns.reset(),n._activeCampaignsCount=t.al.length,t.al.forEach(function(t){var i=new e;i.initWithJson(t),i.getContent(function(){var e=i;n.getInstance().endUpdate(e)})},this))},n.prototype.endUpdate=function(e){n._activeCampaignsCount--;var t=n.getInstance()._givePackageFromPlatform(e.packages);null!=t&&(e.currentPackage=t,n._activeCampaigns.push(e)),n._activeCampaignsCount<=0&&n._managerListener.endUpdate()},n.prototype._givePackageFromPlatform=function(e){for(var n=null,i=0;i<e.length;i++)"BRW_DSK"!=e[i].device||!t.isDesktop()||t.isMobile()||t.isTablet()?"BRW_SP"==e[i].device&&t.isMobile()?n=e[i]:"BRW_TAB"==e[i].device&&t.isTablet()&&(n=e[i]):n=e[i];return null==n?null:(n.unzippedUrl=n.unzippedUrl.replace("http://","https://"),n)},n.prototype.updateSettings=function(e,t){n._endpoint=e,n._siteId=t},n.getInstance=function(){return null===i&&(i=new n),i},n.getInstance()}),define("js/Trackers/Sync2AdUniversalTracker",["../Utils/AdsUtils"],function(e){function t(){this.isReady=!1,this.isDisabled=!1,this.sdkStarted=!1,this.statusTime=null,this.activationTime=null,this.APP_STATUS={},this.APP_STATUS.FG="FG",this.APP_STATUS.BG="BG",this.CUSTOM_DIMENSIONS={},this.CUSTOM_DIMENSIONS.EVENT=1,this.CUSTOM_DIMENSIONS.CAMPAIGN=2,this.CUSTOM_DIMENSIONS.AUDIO_TRACK=3,this.CUSTOM_DIMENSIONS.SAMPLE=4,this.CUSTOM_DIMENSIONS.APP_STATUS=5,this.CUSTOM_DIMENSIONS.HOSTING_APP=6,this.CUSTOM_DIMENSIONS.TRIGGER=7,this.CUSTOM_DIMENSIONS.CANCEL_CAUSE=8,this.CUSTOM_DIMENSIONS.SURFACE_SOURCE=9,this.CUSTOM_DIMENSIONS.VIDEO_ID=10,this.CUSTOM_DIMENSIONS.INTERACTION_ELEMENT=12,this.CUSTOM_DIMENSIONS.URL=13,this.CUSTOM_DIMENSIONS.PUSH_TYPE=15,this.CUSTOM_DIMENSIONS.SDK_VERSION=17,this.CUSTOM_METRICS={},this.CUSTOM_METRICS.LISTENING_TIME=1,this.CUSTOM_METRICS.ACTIVATION_TIME=2,this.CUSTOM_METRICS.STATUS_TIME=3,this.CUSTOM_METRICS.DISPLAY_TIME=4,this.SCREEN_NAME={},this.SCREEN_NAME.GENERIC_DATA="S2Ad Generic Data",this.SCREEN_NAME.TEASER="S2Ad Teaser",this.SCREEN_NAME.EXPANDED="S2Ad Expanded",this.SCREEN_NAME.WEBVIEW="S2Ad Package",this.EVENTS={},this.EVENTS.S2AD_STARTED="S2AD_STARTED",this.EVENTS.S2AD_PAUSED="S2AD_PAUSED",this.EVENTS.S2AD_STOPPED="S2AD_STOPPED",this.EVENTS.S2AD_ENDOFBG="S2AD_ENDOFBG",this.EVENTS.S2AD_ENDOFFG="S2AD_ENDOFFG",this.EVENTS.PACKAGE_DL="PACKAGE_DL",this.EVENTS.MIC_OPENED="MIC_OPENED",this.EVENTS.MIC_CLOSED="MIC_CLOSED",this.EVENTS.AD_DETECTION_ACR="AD_DETECTION_ACR",this.EVENTS.AD_DETECTION_PUSH="AD_DETECTION_PUSH",this.EVENTS.DISPLAY_NOTIFICATION="DISPLAY_NOTIFICATION",this.EVENTS.DISPLAY_CANCELLED="DISPLAY_CANCELLED",this.EVENTS.DISPLAY_TEASER="DISPLAY_TEASER",this.EVENTS.DISPLAY_EXPANDED="DISPLAY_EXPANDED",this.EVENTS.USER_CLOSE="USER_CLOSE",this.EVENTS.AUTO_CLOSE="AUTO_CLOSE",this.EVENTS.USER_INTERACTION="USER_INTERACTION",this.EVENTS.USER_REDIRECTION="USER_REDIRECTION",this.EVENTS.VIDEO_AUTOPLAY="VIDEO_AUTOPLAY",this.EVENTS.VIDEO_PLAY="VIDEO_PLAY",this.EVENTS.VIDEO_END="VIDEO_END",this.EVENTS.VIDEO_HALFVIEWED="VIDEO_HALFVIEWED",this.EVENTS.VIDEO_UNMUTE="VIDEO_UNMUTE",this.EVENTS.USER_FB_SHARE="USER_FB_SHARE",this.EVENTS.USER_TW_SHARE="USER_TW_SHARE",this.EVENTS.INIT_TEASER="INIT_TEASER"}var n=null;return t.prototype.init=function(e,t){this.appId=e,this.appName=t},t.prototype.disableTracker=function(){this.isReady=!1,this.isDisabled=!0},t.prototype.resetTracker=function(e){!this.isDisabled&&s2a_ga&&(s2a_ga("create",e,"auto"),s2a_ga("set","appName","Sync2AdJS"),s2a_ga("set","appVersion",Sync2Ad.getVersion()),s2a_ga(function(e){this.tracker=e,this.isReady=!0}.bind(n)))},t.prototype.onSync2AdStarted=function(){if(!this.sdkStarted&&!this.isDisabled){this.sdkStarted=!0,this.statusTime=new Date,this.activationTime=new Date;var e=[];e.push({key:"screenName",value:this.SCREEN_NAME.GENERIC_DATA}),e.push({key:"dimension"+this.CUSTOM_DIMENSIONS.EVENT,value:this.EVENTS.S2AD_STARTED}),e.push({key:"dimension"+this.CUSTOM_DIMENSIONS.APP_STATUS,value:this.APP_STATUS.FG}),e.push({key:"dimension"+this.CUSTOM_DIMENSIONS.HOSTING_APP,value:"{0}-{1}".format(this.appId,this.appName)}),this.sendTracking(e)}},t.prototype.onSync2AdStopped=function(){if(this.sdkStarted&&!this.isDisabled){var e=[],t=new Date;(t-this.statusTime)/1e3,(t-this.activationTime)/1e3;e.push({key:"screenName",value:this.SCREEN_NAME.GENERIC_DATA}),e.push({key:"dimension"+this.CUSTOM_DIMENSIONS.EVENT,value:this.EVENTS.S2AD_STOPPED}),e.push({key:"dimension"+this.CUSTOM_DIMENSIONS.APP_STATUS,value:this.APP_STATUS.FG}),e.push({key:"dimension"+this.CUSTOM_DIMENSIONS.HOSTING_APP,value:"{0}-{1}".format(this.appId,this.appName)}),this.sdkStarted=!1,this.statusTime=new Date,this.sendTracking(e)}},t.prototype.onCampaignDisplayCancelled=function(e,t){if(!this.isDisabled){var n=[];n.push({key:"screenName",value:this.SCREEN_NAME.GENERIC_DATA}),n.push({key:"dimension"+this.CUSTOM_DIMENSIONS.EVENT,value:this.EVENTS.DISPLAY_CANCELLED}),n.push({key:"dimension"+this.CUSTOM_DIMENSIONS.CAMPAIGN,value:"{0}-{1}".format(e.id,e.name)}),n.push({key:"dimension"+this.CUSTOM_DIMENSIONS.APP_STATUS,value:this.APP_STATUS.FG}),n.push({key:"dimension"+this.CUSTOM_DIMENSIONS.HOSTING_APP,value:"{0}-{1}".format(this.appId,this.appName)}),n.push({key:"dimension"+this.CUSTOM_DIMENSIONS.PUSH_TYPE,value:e.pushType}),n.push({key:"dimension"+this.CUSTOM_DIMENSIONS.TRIGGER,value:"push"}),n.push({key:"dimension"+this.CUSTOM_DIMENSIONS.CANCEL_CAUSE,value:t}),this.sendTracking(n)}},t.prototype.onInitTeaser=function(e){if(!this.isDisabled){var t=[];t.push({key:"screenName",value:this.SCREEN_NAME.GENERIC_DATA}),t.push({key:"dimension"+this.CUSTOM_DIMENSIONS.EVENT,value:this.EVENTS.INIT_TEASER}),t.push({key:"dimension"+this.CUSTOM_DIMENSIONS.CAMPAIGN,value:"{0}-{1}".format(e.id,e.name)}),t.push({key:"dimension"+this.CUSTOM_DIMENSIONS.HOSTING_APP,value:"{0}-{1}".format(this.appId,this.appName)}),t.push({key:"dimension"+this.CUSTOM_DIMENSIONS.PUSH_TYPE,value:e.pushType}),t.push({key:"dimension"+this.CUSTOM_DIMENSIONS.TRIGGER,value:"push"}),t.push({key:"dimension"+this.CUSTOM_DIMENSIONS.SURFACE_SOURCE,value:"push"}),this.sendTracking(t)}},t.prototype.onCampaignPush=function(e){if(!this.isDisabled){var t=[];t.push({key:"screenName",value:this.SCREEN_NAME.GENERIC_DATA}),t.push({key:"dimension"+this.CUSTOM_DIMENSIONS.EVENT,value:this.EVENTS.AD_DETECTION_PUSH}),t.push({key:"dimension"+this.CUSTOM_DIMENSIONS.CAMPAIGN,value:"{0}-{1}".format(e.id,e.name)}),t.push({key:"dimension"+this.CUSTOM_DIMENSIONS.HOSTING_APP,value:"{0}-{1}".format(this.appId,this.appName)}),t.push({key:"dimension"+this.CUSTOM_DIMENSIONS.PUSH_TYPE,value:e.pushType}),this.sendTracking(t)}},t.prototype.onPackageSendToTracker=function(e){if(!this.isDisabled){var t=e.screenName,n=JSON.parse(e.customDimensions),i=JSON.parse(e.customMetrics),a=[];a.push({key:"screenName",value:t});for(var s in n)a.push({key:"dimension"+s,value:n[s]});for(var r in i)a.push({key:"metric"+r,value:i[r]});this.sendTracking(a)}},t.prototype.sendTracking=function(t){if(!this.isDisabled)if(this.isReady){t.push({key:"dimension"+this.CUSTOM_DIMENSIONS.SDK_VERSION,value:Sync2Ad.getVersion()});var n="[Tracking]";for(var i in this.CUSTOM_DIMENSIONS){var a=t.filter(function(e){return e.key=="dimension"+this.CUSTOM_DIMENSIONS[i]},this);0==a.length?t.push({key:"dimension"+this.CUSTOM_DIMENSIONS[i],value:"-"}):n+="<br />&nbsp;&nbsp;&nbsp;&nbsp;{0}({1}) : {2}".format(i,this.CUSTOM_DIMENSIONS[i],a[0].value)}for(var s in this.CUSTOM_METRICS){var a=t.filter(function(e){return e.key=="metric"+this.CUSTOM_METRICS[s]},this);0==a.length?t.push({key:"metric"+this.CUSTOM_METRICS[s],value:"-"}):n+="<br />&nbsp;&nbsp;&nbsp;&nbsp;{0}({1}) : {2}".format(s,this.CUSTOM_METRICS[s],a[0].value)}e.adsLog.Info(n),t.forEach(function(e){this.tracker.set(e.key,e.value)},this),this.tracker.send("screenview")}else{var r=this;setTimeout(function(){r.sendTracking(t)},500)}},t.prototype.isReady=function(){return this.isReady},t.getInstance=function(){return null===n&&(n=new t),n},t.getInstance()}),define("js/Models/AdsSettings",["../Utils/AdsUtils"],function(e){function t(){this.version="",this.campaignsVersion="",this.updateIntervalSec=0,this.s2aCappingIntervalInSeconds=0,this.s2aCappingMaxSurfacePerInterval=0,this.s2aCappingMinDeltaIntervalForSurface=0,this.hostCappingIntervalInSeconds=0,this.hostCappingMaxSurfacePerInterval=0,this.hostCappingMinDeltaIntervalForSurface=0,this.applicationName="",this.uaTrackingId="",this.kinesisStreamName="",this.kinesisStreamRegion="",this.cognito={accountId:"",identityPool:"",unauthRole:"",authRole:""},this.eventValidityTime=61}return t.mapping=[{"long":"version","short":"v"},{"long":"campaignsVersion","short":"cv"},{"long":"updateIntervalSec","short":"uis"},{"long":"s2aCappingIntervalInSeconds","short":"s2acis"},{"long":"s2aCappingMaxSurfacePerInterval","short":"s2acmspi"},{"long":"s2aCappingMinDeltaIntervalForSurface","short":"s2acmdifs"},{"long":"hostCappingIntervalInSeconds","short":"acis"},{"long":"hostCappingMaxSurfacePerInterval","short":"acmspi"},{"long":"hostCappingMinDeltaIntervalForSurface","short":"acmdifs"},{"long":"applicationName","short":"an"},{"long":"uaTrackingId","short":"uai"},{"long":"kinesisStreamName","short":"ksn"},{"long":"kinesisStreamRegion","short":"ksr"},{"long":"cognito.accountId","short":"co.ai"},{"long":"cognito.identityPool","short":"co.ip"},{"long":"cognito.unauthRole","short":"co.ur"},{"long":"cognito.authRole","short":"co.ar"},{"long":"eventValidityTime","short":"evt"}],t.prototype.initWithJson=function(n){e.mapJson(n,t.mapping,this)},t}),define("js/Models/AdsEvent",["./AdsCampaign"],function(e){function t(t){this.eventId=t.eventId||0,this.date=t.date||new Date(0),this.campaign=t.campaign||new e,this.active=t.active||!1}return t}),define("js/Managers/CappingManager",["../Models/AdsEvent","../Utils/AdsUtils","../Managers/AdsCampaignManager"],function(e,t,n){function i(){}var a=null;return i.displayedCountSavedValue={},i.s2aCappingIntervalInSeconds=0,i.s2aCappingMaxSurfacePerInterval=0,i.s2aCappingMinDeltaIntervalForSurface=0,i.hostCappingIntervalInSeconds=0,i.hostCappingMaxSurfacePerInterval=0,i.hostCappingMinDeltaIntervalForSurface=0,i._hostName="",i._adEventList={},i._eventValidityTime=0,i._eventCount=-1,i._CAPPING_EVENTS_LS="Capping_Events_LocalStorage",i._CAPPING_DISPLAYED_COUNT_LS="Capping_DisplayedCountSavedValue_LocalStorage",i._getInstance=function(){if(null===a&&(a=new i,void 0!=localStorage[i._CAPPING_EVENTS_LS])){var e={};void 0!=localStorage[i._CAPPING_DISPLAYED_COUNT_LS]&&(e=JSON.parse(localStorage[i._CAPPING_DISPLAYED_COUNT_LS])),i._adEventList=JSON.parse(localStorage[i._CAPPING_EVENTS_LS]);for(var t in i._adEventList){var s=n.getActiveCampaigns()[t],r=i.s2aCappingMaxSurfacePerInterval;r>i.hostCappingMaxSurfacePerInterval&&(r=i.hostCappingMaxSurfacePerInterval),s&&r>s.campaignCappingMaxSurfacePerInterval&&(r=s.campaignCappingMaxSurfacePerInterval);for(var o=0;o<i._adEventList[t].length;o++)i._eventCount<parseInt(i._adEventList[t][o].eventId)&&(i._eventCount=parseInt(i._adEventList[t][o].eventId)),i._adEventList[t][o].date=new Date(i._adEventList[t][o].date);i._adEventList[t].length>r&&i._adEventList[t].slice(0,i._adEventList[t].length-r),i.displayedCountSavedValue[t]=null==e[t]?0:e[t]}}return a},i.setSettingsCappingValues=function(e){i.s2aCappingIntervalInSeconds=e.s2aCappingIntervalInSeconds,i.s2aCappingMaxSurfacePerInterval=e.s2aCappingMaxSurfacePerInterval,i.s2aCappingMinDeltaIntervalForSurface=e.s2aCappingMinDeltaIntervalForSurface,i.hostCappingIntervalInSeconds=e.hostCappingIntervalInSeconds,i.hostCappingMaxSurfacePerInterval=e.hostCappingMaxSurfacePerInterval,i.hostCappingMinDeltaIntervalForSurface=e.hostCappingMinDeltaIntervalForSurface,i._hostName=e.applicationName,i._eventValidityTime=e.eventValidityTime},i._underMaxSurface=function(e,t,n){if(0==t)return!0;if(void 0==i._adEventList[e])return!0;if(!n)return i.displayedCountSavedValue[e]<t;for(var a=0,s=0;s<i._adEventList[e].length;s++)i._adEventList[e][s].active||a++;return a<t},i._underDeltaTimeInSec=function(e,t,n){if(void 0==i._adEventList[e])return!0;var a=null;if(n){for(var s=i._adEventList[e].length-1;s>=0;s--)if(!i._adEventList[e][s].active){a=i._adEventList[e][s];break}}else a=i._adEventList[e][i._adEventList[e].length-1];if(null==a)return!0;var r=new Date(a.date.getTime());return r.setSeconds(r.getSeconds()+t),r<=new Date},i._periodicitySurface=function(e,t,n){if(void 0==i._adEventList[e])return 0;for(var a=0,s=0;s<i._adEventList[e].length;s++){var r=new Date(i._adEventList[e][s].date.getTime());r.setSeconds(r.getSeconds()+t),n?!i._adEventList[e][s].active&&r>new Date&&a++:r>new Date&&a++}return a},i._underPeriodicitySurface=function(e,t,n,a){if(0==t)return!0;if(void 0==i._adEventList[e])return!0;var s=i._periodicitySurface(e,n,a);return!(++s>t)},i._isCampaignCapped=function(e,n){var a=i._underMaxSurface(e.id,e.campaignCappingSurfaceMax,n),s=i._underDeltaTimeInSec(e.id,e.campaignCappingMinDeltaIntervalForSurface,n),r=i._underPeriodicitySurface(e.id,e.campaignCappingMaxSurfacePerInterval,e.campaignCappingIntervalSeconds,n);return t.adsLog.Info("[Capping] Capping for campaign '{0}'<br />&nbsp;&nbsp;&nbsp;&nbsp;-> Under Max Surface ({1}) : {2}<br />&nbsp;&nbsp;&nbsp;&nbsp;-> Under Delta Time In Sec ({3}) : {4}<br />&nbsp;&nbsp;&nbsp;&nbsp;-> Under Periodicity Surface ({5} - {6} sec) : {7}".format(e.name,e.campaignCappingSurfaceMax,a,e.campaignCappingMinDeltaIntervalForSurface,s,e.campaignCappingMaxSurfacePerInterval,e.campaignCappingIntervalSeconds,r)),!a||!s||!r},i._isHostCapped=function(e,n,a){for(var s=!0,r=0,o=0;o<n.length;o++)r+=i._periodicitySurface(n[o].id,i.hostCappingIntervalInSeconds,a),i._underDeltaTimeInSec(n[o].id,i.hostCappingMinDeltaIntervalForSurface,a)||(s=!1);return t.adsLog.Info("[Capping] Capping for app '{0}'<br />&nbsp;&nbsp;&nbsp;&nbsp;-> Under Delta Time In Sec ({1}) : {2}<br />&nbsp;&nbsp;&nbsp;&nbsp;-> Under Periodicity Surface ({3} - {4} sec) : {5}".format(i._hostName,i.hostCappingMinDeltaIntervalForSurface,s,i.hostCappingMaxSurfacePerInterval,i.hostCappingIntervalInSeconds,r<i.hostCappingMaxSurfacePerInterval)),!s||!(0==i.hostCappingMaxSurfacePerInterval||r<i.hostCappingMaxSurfacePerInterval)},i._isGlobalCapped=function(e,n,a){for(var s=!0,r=0,o=0;o<n.length;o++)r+=i._periodicitySurface(n[o].id,i.s2aCappingIntervalInSeconds,a),i._underDeltaTimeInSec(n[o].id,i.s2aCappingMinDeltaIntervalForSurface,a)||(s=!1);return t.adsLog.Info("[Capping] Global capping<br />&nbsp;&nbsp;&nbsp;&nbsp;-> Under Delta Time In Sec ({0}) : {1}<br />&nbsp;&nbsp;&nbsp;&nbsp;-> Under Periodicity Surface ({2} - {3} sec) : {4}".format(i.s2aCappingMinDeltaIntervalForSurface,s,i.s2aCappingMaxSurfacePerInterval,i.s2aCappingIntervalInSeconds,r<i.s2aCappingMaxSurfacePerInterval)),!s||!(0==i.s2aCappingMaxSurfacePerInterval||r<i.s2aCappingMaxSurfacePerInterval)},i._removeOldEvents=function(){var e=[];for(var t in i._adEventList)for(var n=0;n<i._adEventList[t].length;n++){var a=new Date(i._adEventList[t][n].date.getTime());a.setSeconds(a.getSeconds()+i._eventValidityTime),i._adEventList[t][n].active&&a<new Date&&(console.log("remove item "+t+" - id: "+i._adEventList[t][n].eventId),e.push({key:t,id:i._adEventList[t][n].eventId}))}for(var n=0;n<e.length;n++)for(var s=0;s<i._adEventList[t].length;s++)i._adEventList[e[n].key][s].eventId==e[n].id&&(console.log("remove item "+e[n].key+" - id: "+e[n].id),i._adEventList[e[n].key].splice(s,1));i._saveInLocalStorage()},i.isEventValid=function(e,t){i._removeOldEvents();for(var n=0;n<i._adEventList[e].length;n++)if(i._adEventList[e][n].eventId==t)return!0;return!1},i.makeEventInactive=function(e,t){for(var n=0;n<i._adEventList[e].length;n++)i._adEventList[e][n].eventId==t&&(i._adEventList[e][n].active=!1,i.displayedCountSavedValue[e]=null==i.displayedCountSavedValue[e]?1:i.displayedCountSavedValue[e]+1,i._saveInLocalStorage())},i.isPushCapped=function(t,n){i._removeOldEvents();var a={capped:!0,event:null};if(i._isCampaignCapped(t,!1)||i._isHostCapped(t,n,!1)||i._isGlobalCapped(t,n,!1)||(a.capped=!1),!a.capped){var s=new e({eventId:++i._eventCount,date:new Date,campaign:t,active:!0});void 0==i._adEventList[t.id]&&(i._adEventList[t.id]=[]),i._adEventList[t.id].push(s),i._saveInLocalStorage(),a.event=s}return a},i.isDisplayCapped=function(e,t){i._removeOldEvents();var n=!0;return i._isCampaignCapped(e.campaign,!0)||i._isHostCapped(e.campaign,t,!0)||i._isGlobalCapped(e.campaign,t,!0)||(n=!1,i.makeEventInactive(e.campaign.id,e.eventId)),n},i._saveInLocalStorage=function(){localStorage[i._CAPPING_EVENTS_LS]=JSON.stringify(i._adEventList),localStorage[i._CAPPING_DISPLAYED_COUNT_LS]=JSON.stringify(i.displayedCountSavedValue)},i.prototype={isPushCapped:i.isPushCapped,isDisplayCapped:i.isDisplayCapped,setSettingsCappingValues:i.setSettingsCappingValues,makeEventInactive:i.makeEventInactive,isEventValid:i.isEventValid},i._getInstance()}),define("js/Managers/KinesisManager",["../Utils/AdsUtils"],function(e){function t(){this.savedRecord=null}var n=null;return t.stream="",t.pool="",t.region="",t.iframe=null,t.prototype.waitingFailedRecords=[],t.prototype.timeout=null,t.isInitialize=!1,t.prototype.isIframeInit=!1,t._getInstance=function(){return null===n&&(n=new t),n},t.prototype.initWithRegion=function(e,n,i){if(!t.isInitialize){t.iframe=document.createElement("iframe"),t.iframe.setAttribute("style","display: none;");var a='<html><body><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/aws-sdk/2.2.22/aws-sdk.min.js"></script><script type="text/javascript">function receiver(event){try{var json=JSON.parse(event.data); if(json.func == "isInit") { window.parent.postMessage(JSON.stringify({func:"onIsInit", params: [window.kinesis]}), "*"); } if(json.func == "putRecord") {window.kinesis.putRecord(json.params[0], function(err, data) {});} if(json.func == "init"){AWS.config.region = json.params[1];AWS.config.credentials = new AWS.CognitoIdentityCredentials({IdentityPoolId: json.params[0]});window.kinesis = new AWS.Kinesis();}}catch(e){return;}};window.addEventListener("message", receiver, false);</script></body></html>';document.body.appendChild(t.iframe),t.iframe.contentWindow.document.open(),t.iframe.contentWindow.document.write(a),t.iframe.contentWindow.document.close(),t.stream=i,t.pool=n,t.region=e,t.isInitialize=!0}},t.prototype.sendRecord=function(e){if(t.iframe.contentWindow.postMessage(JSON.stringify({func:"init",params:[t.pool,t.region]}),"*"),t.iframe.contentWindow.postMessage(JSON.stringify({func:"isInit",params:[]}),"*"),this.isIframeInit){if(this.waitingFailedRecords.length>0){for(var n=0;n<this.waitingFailedRecords.length;n++)this.sendToKinesis(this.waitingFailedRecords[n]);this.waitingFailedRecords.reset()}null!=e&&this.sendToKinesis(e)}else{clearTimeout(this.timeout),this.timeout=null,null!=e&&this.waitingFailedRecords.push(e);var i=this;this.timeout=setTimeout(function(){i.sendRecord(null)},500)}},t.prototype.sendToKinesis=function(n){var i=(new Date).getTime()+"",a={Data:JSON.stringify(n),PartitionKey:i,StreamName:t.stream},s="[Kinesis] SendRecord<br />&nbsp;&nbsp;&nbsp;&nbsp;t: '{0}'".format(n.t);n.tgr&&(s+="<br />&nbsp;&nbsp;&nbsp;&nbsp;tgr: '{0}'".format(n.tgr)),s+="<br />&nbsp;&nbsp;&nbsp;&nbsp;aid: '{0}'<br />&nbsp;&nbsp;&nbsp;&nbsp;did: '{1}'<br />&nbsp;&nbsp;&nbsp;&nbsp;cid: '{2}'<br />&nbsp;&nbsp;&nbsp;&nbsp;dt: '{3}'<br />&nbsp;&nbsp;&nbsp;&nbsp;sv: '{4}'".format(n.aid,n.did,n.cid,n.dt,n.sv),e.adsLog.Info(s),t.iframe.contentWindow.postMessage(JSON.stringify({func:"putRecord",params:[a]}),"*")},t.prototype.sendSavedRecord=function(){null!=this.savedRecord&&(this.sendRecord(this.savedRecord),this.savedRecord=null)},t.prototype.saveRecord=function(e){this.savedRecord=e},t._getInstance()}),define("js/Managers/AdsManager",["./AdsCampaignManager","../Trackers/Sync2AdUniversalTracker","../Utils/AdsUtils","../Models/AdsCampaign","../Models/AdsSettings","../Models/AdsEvent","../Models/Sync2AdEvent","./CappingManager","./KinesisManager"],function(e,t,n,i,a,s,r,o,d){function p(){this.tracker=t,this.tracker.init()}var c=null;p._siteId,p._endpoint,p._view,p._size=null,p._safeframe={enabled:!1,type:"none",id:"none"},p._sfExpand={},p._sfHeightFix=-1,p._settings=new a,p._currentAd=new i,p._isAdPushed=!1,p._isAdDisplayed=!1,p._isStarted=!1,p._firstStart=!0,p._updateTimer,p._sync2AdListener;var l=null;return p.updateSettings=function(t,n){p._endpoint=t,p._siteId=n,e.updateSettings(t,n)},p.setSync2AdListener=function(e){p._sync2AdListener=e,n.setSync2AdListener=e},p.startAdsContentManager=function(){p._isStarted||(e.setManagerListener(p),p._doUpdate(),p._isStarted=!0,p._firstStart=!0)},p._onSettingsRetrieved=function(i){var s=new a;s.initWithJson(i);var r=p._settings.campaignsVersion!==s.campaignsVersion;p._settings=s,s=void 0,t.disableTracker(),t.isReady||t.resetTracker(p._settings.uaTrackingId),t.init(p._siteId,p._settings.applicationName),t.onSync2AdStarted(),o.setSettingsCappingValues(p._settings),d.initWithRegion(p._settings.kinesisStreamRegion,p._settings.cognito.identityPool,p._settings.kinesisStreamName),null!=p._updateTimer&&clearTimeout(p._updateTimer),p._updateTimer=window.setTimeout(p._doUpdate.bind(p),1e3*p._settings.updateIntervalSec),r?(n.adsLog.Debug("---> Update : campaign.json"),e.fetchCampaignFromJSON(p._settings.campaignsVersion)):p.endUpdate()},p.stopAdsContentManager=function(){
void 0!=p._updateTimer&&window.clearTimeout(p._updateTimer),e.reset(),p._settings=new a,p._currentAd=new i,p._isAdPushed=!1,p._isAdDisplayed=!1,p._isStarted=!1},p.resetManager=function(){p.stopAds(),p.stopAdsContentManager()},p._getViewSize=function(){var e=null,t={x:0,y:0,w:0,h:0};return e=p._iframe.getAttribute("src").indexOf("popup.html")>-1?p._currentAd.currentPackage.position.popup:p._currentAd.currentPackage.position.content,e.x.indexOf("%")>-1?t.x=Math.floor(parseFloat(e.x)/100*window.screen.availWidth):t.x=parseFloat(e.x),e.y.indexOf("%")>-1?t.y=Math.floor(parseFloat(e.y)/100*window.screen.availHeight):t.y=parseFloat(e.y),e.w.indexOf("%")>-1?t.w=Math.floor(parseFloat(e.w)/100*window.screen.availWidth):t.w=parseFloat(e.w),e.h.indexOf("%")>-1?t.h=Math.floor(parseFloat(e.h)/100*window.screen.availHeight):t.h=parseFloat(e.h),t},p._resizeViewContainer=function(){var e=p._getViewSize();e.id=p._safeframe.id,e.position="fixed",e.display="",window.parent.postMessage(JSON.stringify({event:"sync_sf_resize",data:e}),"*")},p.setIframePosition=function(e,t){var n,i=0;p._size?(n=p._size[0],i=p._size[1]):"body"==p._view.tagName.toLowerCase()?(n=window.innerWidth,i=window.innerHeight):(n=p._view.offsetWidth,i=p._view.offsetHeight);var a=0;a=t.x.indexOf("%")>-1?parseFloat(t.x)/100*n:parseFloat(t.x);var s=0;s=t.y.indexOf("%")>-1?parseFloat(t.y)/100*i:parseFloat(t.y);var r=parseFloat(t.w)/100,o=parseFloat(t.h)/100;e.setAttribute("width",""+n*r),p._sfHeightFix!=-1?setTimeout(function(){e.setAttribute("height",""+p._sfHeightFix),p._sfHeightFix=-1},500):e.setAttribute("height",""+i*o),e.setAttribute("frameborder","0"),e.setAttribute("style","position: absolute; z-index: 9999999999999; top: "+s+"px; left: "+a+"px;"),p._safeframe.enabled||"body"!=p._view.tagName.toLowerCase()||(e.style.transform="translateX("+window.innerWidth+"px)")},p.throttleResize=function(){clearTimeout(p._resizeThrottleTimeout),p._resizeThrottleTimeout=setTimeout(p.onOrientationChanged.bind(p),100)},p.onOrientationChanged=function(){var e=null;if(p._iframe&&(e=p._iframe.getAttribute("src").indexOf("popup.html")>-1?p._currentAd.currentPackage.position.popup:p._currentAd.currentPackage.position.content),"body"==p._view.tagName.toLowerCase()&&!p._safeframe.enabled){var t=document.getElementById("s2ad-div");t&&(t.style.width=window.innerWidth+"px",t.style.height=window.innerHeight+"px",t.style.transform="translateX(-"+window.innerWidth+"px)")}var n=p._iframe.getAttribute("width"),i=p._iframe.getAttribute("height");"sync"!==p._safeframe.type&&p.setIframePosition(p._iframe,e),n==p._iframe.getAttribute("width")&&i==p._iframe.getAttribute("height")||p._sendMessage({func:"onOrientationChanged",data:{width:p._iframe.getAttribute("width"),height:p._iframe.getAttribute("height")}}),p._safeframe.enabled&&"sync"===p._safeframe.type&&p._resizeViewContainer()},p.startExtend=function(){return!!p._isStarted&&(p._iframe.setAttribute("style","display: none;"),p._iframe.setAttribute("src",p._currentAd.currentPackage.unzippedUrl.replace("popup.html","index.html")+"?campaign={0}&app={1}&trigger={2}&surfsrc=push&pushtype={3}&ismobile=false&width={4}&height={5}&log={6}&track={7}".format(p._currentAd.id+"-"+p._currentAd.name,p._siteId+"-"+p._settings.applicationName,p._currentAd.pushType+"-push",p._currentAd.pushType,encodeURIComponent(p._iframe.getAttribute("width")),encodeURIComponent(p._iframe.getAttribute("height")),n.logLevelToString(),encodeURIComponent(p._currentAd.pushActivationTrack))),void("sync"!==p._safeframe.type?p.setIframePosition(p._iframe,p._currentAd.currentPackage.position.content):(p._resizeViewContainer(),p._iframe.setAttribute("style",'display: "";'))))},p.startAds=function(i){if(!p._isStarted)return!1;if(!o.isEventValid(i.campaign.id,i.eventId))return n.adsLog.Info("Sync2Ad.startAds ::: false -> event invalid"),!1;if(o.isDisplayCapped(i,e.getActiveCampaigns()))return t.onCampaignDisplayCancelled(i.campaign,"capping"),n.adsLog.Info("Sync2Ad.startAds ::: false -> capped"),!1;p._isAdDisplayed=!0;var a="";void 0==p._view&&(p._view=document.body),a="body"==p._view.tagName.toLowerCase()?"position: fixed;":"position: absolute;",l&&window.removeEventListener("message",l),l=p._onMessage.bind(p),window.addEventListener("message",l,!1);var s,c=0;"body"==p._view.tagName.toLowerCase()&&"sync"!==p._safeframe.type?(s=window.innerWidth,c=window.innerHeight):(s=p._view.offsetWidth,c=p._view.offsetHeight);var u=document.getElementById("s2ad-div");u?(s=p._size[0],c=p._size[1]):(u=document.createElement("div"),u.setAttribute("class","s2ad-div"),u.setAttribute("id","s2ad-div"),"sync"!==p._safeframe.type?u.setAttribute("style",a+"z-index: 999999999999; width: "+s+"px; height: "+c+"px;"):u.setAttribute("style",a+"z-index: 999999999999; width: 100%; height: 100%; top:0%; left:0%")),p._sfExpand={w:s,h:c,e:i};var g=document.createElement("iframe");return"sync"!==p._safeframe.type?p.setIframePosition(g,i.campaign.currentPackage.position.popup):(g.width=g.height="100%",g.frameBorder="0"),g.setAttribute("id","s2ad-iframe"),g.setAttribute("src",i.campaign.currentPackage.unzippedUrl+"?campaign={0}&app={1}&trigger={2}&surfsrc=push&pushtype={3}&ismobile=false&width={4}&height={5}&log={6}&track={7}".format(i.campaign.id+"-"+i.campaign.name,p._siteId+"-"+p._settings.applicationName,"push",i.campaign.pushType,encodeURIComponent(g.getAttribute("width")),encodeURIComponent(g.getAttribute("height")),n.logLevelToString(),encodeURIComponent(i.campaign.pushActivationTrack))),g.setAttribute("scrolling","no"),u.appendChild(g),p._view.insertBefore(u,p._view.childNodes[0]),p._safeframe.enabled||"body"!=p._view.tagName.toLowerCase()||(u.style.transform="translateX(-"+window.innerWidth+"px)",g.style.transform="translateX("+window.innerWidth+"px)"),p._safeframe.enabled&&"sync"===p._safeframe.type&&(p._view.height="100%"),p._iframe=g,p._currentAd=i.campaign,p._sync2AdListener.onEvent(new r({eventId:i.eventId,date:new Date,type:r.EventType.AD_TEASER_OPENED,campaign:i.campaign})),n.adsLog.Info("Sync2Ad.startAds ::: true"),t.onInitTeaser(i.campaign),d.saveRecord({t:"print",tgr:i.campaign.pushType+"-push",aid:p._siteId,did:"js",cid:i.campaign.id,dt:n.isAndroid()?4:n.isIOS()?3:n.isWindowsPhone()?5:6,sv:Sync2Ad.getVersion()}),addResizeListener(p._view,p.throttleResize.bind(p)),!0},p.stopAds=function(){if(p._sync2AdListener.onEvent(new r({date:new Date,type:r.EventType.AD_CLOSED,campaign:p._currentAd})),p._safeframe.enabled)if("iab"===p._safeframe.type){var e=window.$sf,t=e&&e.ext;t&&t.collapse()}else if("sync"===p._safeframe.type){var n={x:0,y:0,w:1,h:1,id:p._safeframe.id,position:"fixed",display:"none"};window.parent.postMessage(JSON.stringify({event:"sync_sf_resize",data:n}),"*")}if(p._isAdDisplayed=!1,p._currentAd=new i,p._safeframe.enabled&&"sync"!==p._safeframe.type)document.getElementById("s2ad-div").innerHTML="";else{var a=document.getElementById("s2ad-div");a.parentNode.removeChild(a)}p._iframe=null,removeResizeListener(p._view,p.throttleResize.bind(p))},p.setTargetView=function(e){var t=document.querySelectorAll(e);return 0==t.length?void n.adsLog.Error("Unable to find element"):(t.length>1&&n.adsLog.Warn("Found more than one element, taking first"),p._view=t[0],void(t.reset&&t.reset()))},p._doUpdate=function(){n.getSettingsJson(p._endpoint,p._siteId,p._onSettingsRetrieved.bind(p))},p.endUpdate=function(){var i=e.getActiveCampaigns().filter(function(e,t,n){return e.isSurfaced});if(i.length>0){if(!p._isAdDisplayed){var a=i[0];if(a.isCapped)t.onCampaignDisplayCancelled(a,"capping"),p._firstStart&&(n.adsLog.Info("Sync2Ad::onPassback called"),p._sync2AdListener.onPassback());else{var s=o.isPushCapped(a,e.getActiveCampaigns());s.capped?(t.onCampaignDisplayCancelled(a,"capping"),p._firstStart&&(n.adsLog.Info("Sync2Ad::onPassback called"),p._sync2AdListener.onPassback())):(p._sync2AdListener.onEvent(new r({eventId:s.event.eventId,date:new Date,type:r.EventType.AD_PUSHED,campaign:s.event.campaign})),t.onCampaignPush(s.event.campaign),d.sendRecord({t:s.event.campaign.pushType+"-push",aid:p._siteId,did:"js",cid:s.event.campaign.id,dt:n.isAndroid()?4:n.isIOS()?3:n.isWindowsPhone()?5:6,sv:Sync2Ad.getVersion()}),p._sync2AdListener.shouldStartAds(s.event.campaign)&&p.startAds(s.event))}}}else p._firstStart&&(n.adsLog.Info("Sync2Ad::onPassback called"),p._sync2AdListener.onPassback());p._firstStart=!1,i.reset()},p.isCampaignReady=function(e){},p.getActiveCampaigns=function(){return e.getActiveCampaigns()},p.hasActiveAd=function(){},p._onMessage=function(e){if(e.data){var i;try{i=JSON.parse(e.data)}catch(e){return}switch(n.adsLog.Debug("Sync2Ad SDK : message received from package - function: {0}".format(i.func)),i.func){case"closeAds":case"closeContent":p.stopAds();break;case"closePopup":p.startExtend();break;case"openInBrowser":window.open(i.data.url,"_blank");break;case"getSDKVersion":this._sendMessage({func:"onGetSDKVersion",data:{version:Sync2Ad.getVersion()}});break;case"sendToTracker":var a=JSON.parse(i.data.customDimensions);if(a[1]&&"DISPLAY_TEASER"==a[1])if(d.sendSavedRecord(),p._safeframe.enabled&&"iab"===p._safeframe.type){n.adsLog.Debug("AdsManager._safeframeEnabled = true - Expand");var s,r=(p._sfExpand.e,p._sfExpand.w),o=p._sfExpand.h,c=window.$sf,l=c&&c.ext,u=l.geom().exp;s=p._iframe.getAttribute("src").indexOf("popup.html")>-1?p._currentAd.currentPackage.position.popup:p._currentAd.currentPackage.position.content;var g=0;g=s.x.indexOf("%")>-1?Math.ceil(parseFloat(s.x)/100*r):Math.ceil(parseFloat(s.x));var f=0;f=s.y.indexOf("%")>-1?Math.ceil(parseFloat(s.y)/100*o):Math.ceil(parseFloat(s.y));var h=0;h=s.w.indexOf("%")>-1?Math.ceil(r*parseFloat(s.w)/100):Math.ceil(parseFloat(s.w));var _=0;_=s.h.indexOf("%")>-1?Math.ceil(o*parseFloat(s.h)/100):Math.ceil(parseFloat(s.h)),l.expand({l:g<u.l?u.l:g,t:f<u.t?u.t:f,r:g+h>u.r?u.r:g+h,b:f+_>u.b?u.b:f+_})}else p._safeframe.enabled&&"sync"===p._safeframe.type&&p._resizeViewContainer();t.onPackageSendToTracker(i.data),a=void 0;break;case"onIsInit":void 0!=i.params[0]&&null!=i.params[0]&&(d.isIframeInit=!0);break;default:n.adsLog.Error("AdsManager._onMessage ::: unknown function")}}},p._sendMessage=function(e){this._iframe.contentWindow.postMessage(JSON.stringify(e),"*")},p.setSize=function(e){p._size=e},p.enableSafeframe=function(e,t){p._safeframe={enabled:!0,type:e,id:t||"none"}},p.onSafeframeUpdated=function(e,t){n.adsLog.Debug("SF - Status: {0}".format(e)),"failed"==e?"exp-ovr"==t.cmd&&$sf.ext.expand($sf.ext.geom().exp):"expanded"==e&&(n.isMobile()||n.isIOS())&&window.innerHeight<=p._sfExpand.h&&(document.getElementById("s2ad-div").style.height=window.innerHeight+"px",p._sfHeightFix=window.innerHeight)},p.prototype={updateSettings:p.updateSettings,startAdsContentManager:p.startAdsContentManager,stopAdsContentManager:p.stopAdsContentManager,resetManager:p.resetManager,startAds:p.startAds,stopAds:p.stopAds,setTargetView:p.setTargetView,endUpdate:p.endUpdate,updateTrackerWithUAID:p.updateTrackerWithUAID,isCampaignReady:p.isCampaignReady,getActiveCampaigns:p.getActiveCampaigns,hasActiveAd:p.hasActiveAd,setSync2AdListener:p.setSync2AdListener,onOrientationChanged:p.onOrientationChanged,setSize:p.setSize,enableSafeframe:p.enableSafeframe,onSafeframeUpdated:p.onSafeframeUpdated},p.getInstance=function(){return null===c&&(c=new p),c},p.getInstance()}),define("js/Sync2Ad",["./Managers/AdsManager","./Utils/AdsUtils","./Listeners/Sync2AdDefaultListener","./Models/Sync2AdEvent","./Trackers/Sync2AdUniversalTracker"],function(e,t,n,i,a){function s(){}var r=null,o="1.0.4",d="S2A_Force_Log";return s._isReady=!1,s._isStarted=!1,s._listener=n,e.setSync2AdListener(s._listener),s._getInstance=function(){return null===r&&(r=new s,"true"==localStorage[d]&&t.forceLog()),r},s.isReady=function(){return s._isReady},s.prototype.setListener=function(n){t.adsLog.Debug("Sync2Ad.setListener"),"function"==typeof n.shouldStartAds&&(s._listener.shouldStartAds=n.shouldStartAds),"function"==typeof n.onEvent&&(s._listener.onEvent=n.onEvent),"function"==typeof n.onLog&&(s._listener.onLog=n.onLog),"function"==typeof n.onPassback&&(s._listener.onPassback=n.onPassback),e.setSync2AdListener(s._listener)},s.prototype.start=function(n){if(s._isStarted)return!1;if(!n.endpoint||!n.siteId)return t.adsLog.Error("You must specify at least endpoint and siteId."),!1;if(/sync2ad-prod/i.test(n.endpoint)&&(n.endpoint="https://services.sync2ad.com"),t.adsLog.Info("Sync2Ad.start(endpoint:{0}, siteId:{1})".format(n.endpoint,n.siteId)),e.updateSettings(n.endpoint,n.siteId),e.startAdsContentManager(),/sync2ad-prod|services.sync2ad/i.test(n.endpoint)){var i=new XMLHttpRequest;i.onreadystatechange=function(){4===i.readyState&&(i=void 0)},i.open("GET","https://vw-sync2ad-prod.s3.amazonaws.com/tracker/s2ajs.gif?appid={0}&t={1}".format(n.siteId,(new Date).getTime()),!0),i.send()}return s._isReady=!0,s._isStarted=!0,n.listener&&this.setListener(n.listener),n.logEnabled&&this.setLogEnabled(n.logEnabled,t.LogLevel.DEBUG),n.targetView&&this.updateTargetView(n.targetView),n.safeframe&&n.syncSafeFrame?(t.adsLog.Error("You can use only one Safe Frame method (iab or sync)"),!1):(n.safeframe&&(e.enableSafeframe("iab"),this.setSize([window.outerWidth<=1?window.screen?window.screen.availWidth:0:window.outerWidth,window.outerHeight<=1?window.screen?window.screen.availHeight:0:window.outerHeight])),n.syncSafeFrame&&e.enableSafeframe("sync",n.containerView),!0)},s.prototype.stop=function(){t.adsLog.Info("Sync2Ad.stop"),e.stopAdsContentManager(),a.onSync2AdStopped(),s._isStarted=!1},s.prototype.startAds=function(n){return t.adsLog.Info("Sync2Ad.startAds"),!!s._isStarted&&e.startAds(n)},s.prototype.stopAds=function(){t.adsLog.Info("Sync2Ad.stopAds"),e.stopAds()},s.prototype.setLogEnabled=function(e,n){t.setLogEnabled(e,n)},s.prototype.setSize=function(n){t.adsLog.Info("Sync2Ad.setSize({0})".format(n));var i=document.createElement("div");i.setAttribute("class","s2ad-div"),i.setAttribute("id","s2ad-div"),i.setAttribute("style","position: fixed;z-index: 999999999999; width: "+n[0]+"px; height: "+n[1]+"px"),document.body.appendChild(i);var a=window.$sf,s=a&&a.ext,r=window.outerWidth<=1?window.screen?window.screen.availWidth:0:window.outerWidth,o=window.outerHeight<=1?window.screen?window.screen.availHeight:0:window.outerHeight;if(s)try{s.register(r,o,e.onSafeframeUpdated)}catch(d){console.log("no SafeFrame available")}e.setSize(n)},s.prototype.updateTargetView=function(n){t.adsLog.Info("Sync2Ad.updateTargetView({0})".format(n)),e.setTargetView(n)},s.prototype.getVersion=function(){return o},s.prototype.getActiveCampaigns=function(){return e.getActiveCampaigns()},s.prototype.LogLevel=t.LogLevel,s.prototype.sync2AdEventType=i.EventType,s._getInstance()}),function(){function e(e){var t=e.target||e.srcElement;t.__resizeRAF__&&s(t.__resizeRAF__),t.__resizeRAF__=a(function(){var n=t.__resizeTrigger__;n.__resizeListeners__.forEach(function(t){t.call(n,e)})})}function t(t){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",e)}var n=document.attachEvent,i=navigator.userAgent.match(/Trident|Edge/),a=function(){var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){return window.setTimeout(e,20)};return function(t){return e(t)}}(),s=function(){var e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout;return function(t){return e(t)}}();window.addResizeListener=function(a,s){if(!a.__resizeListeners__)if(a.__resizeListeners__=[],n)a.__resizeTrigger__=a,a.attachEvent("onresize",e);else{"static"==getComputedStyle(a).position&&(a.style.position="relative");var r=a.__resizeTrigger__=document.createElement("object");r.setAttribute("style","display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; pointer-events: none; z-index: -1;"),r.__resizeElement__=a,r.onload=t,r.type="text/html",i&&a.appendChild(r),r.data="about:blank",i||a.appendChild(r)}a.__resizeListeners__.push(s)},window.removeResizeListener=function(t,i){t.__resizeListeners__=null,n?t.detachEvent("onresize",e):(t.__resizeTrigger__.contentDocument.defaultView.removeEventListener("resize",e),t.__resizeTrigger__=!t.removeChild(t.__resizeTrigger__))}}(),"bind"in Function.prototype||(Function.prototype.bind=function(){var e=this,t=arguments[0],n=Array.prototype.slice.call(arguments,1);return function(){return e.apply(t,n.concat([].slice.call(arguments)))}}),String.prototype.format||(String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(t,n){return"undefined"!=typeof e[n]?e[n]:t})}),Array.prototype.reset||(Array.prototype.reset=function(){this.splice(0,this.length)}),define("main",["./js/Sync2Ad","./js/Trackers/Sync2AdUniversalTracker"],function(e,t){window.Sync2Ad=e}),require("main")});